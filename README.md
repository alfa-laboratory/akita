Akita - бери и тестируй
==========================================

Фреймворк для bdd тестирования на основе cucumber и selenide.

Для написания тестового сценария достаточно подключить библиотеку 
и воспользоваться любым готовым шагом из ru.alfabank.steps
Например:
Функционал: Страница депозитов
  Сценарий: Открытие депозита
    Допустим совершен переход на страницу "Депозиты" по ссылке из property файла = "depositsUrl"
    Когда выполнено нажатие на кнопку "Открыть депозит"
    Тогда страница "Открытие депозита" загрузилась
 
 
Каждая страница, с которой предполагается взаимодействие, должна быть описана в классе, наследующимся от AlfaPage. 
Для каждого элемента следует задать имя на русском, через аннотацию @Name, чтобы искать можно было именно по русскому описанию, а не по селектору. 

Пример описания страницы:
    @Name("Депозиты")
    public class DepositsPage extends AlfaPage {
    
        @FindBy(css = ".deposit_open")
        @Name("Открыть депозит")
        private SelenideElement depositOpenButton;

        @FindBy(css = ".deposit_close")
        @Name("Закрыть депозит")
        private SelenideElement depositCloseButton;

        @FindBy(css = ".deposit_list")
        @Name("Список депозитов пользователя")
        private SelenideElement depositList;
    }

Инициализация страницы
Страница инициализируется каждый раз, когда вызываются методы initialize(<Имя класса страницы>.class) или put(<URL страницы>,<Имя класса страницы>.class).

Пример инициализации страницы "Депозиты":
DepositsPage page = (DepositsPage) getCurrentPage();
alfaScenario.setCurrentPage(page.initialize().appeared());

Для страницы инициализируется карта ее элементов - это те поля, что помечены аннотацией @Name.
Кроме того осуществляется проверка того, что загружена требуемая страница.
Страница считается загруженной корректно, если за отведенное по умолчанию время были загружены основные ее элементы.
Основными элементами являются поля класа страницы с аннотацией @Name, но без аннотации @Optional.
Аннотация @Optional указывает на то, что элемент является не обязательным для принятия решения о загрузке страницы.
Реализована возможность управления временем ожидания появления элемента на странице.
Чтобы установить timeout, отличный от базового, нужно добавить в application.properties строку
waitingAppearTimeout=150000


Доступ к элементам страницы

alfaScenario.getCurrentPage().getElement(elemName)
alfaScenario.getCurrentPage().getElementsList(elemName)
Данные строки позволяют по имени элемента найти его в карте элементов текущей страницы.

Новую текущую страницу можно установить шагом
Когда страница "<Имя страницы>" загрузилась


ru.alfabank.alfatest.cucumber.api.AlfaEnvironment
Используется для хранения страниц и переменных внутри сценария
scenario - Сценарий из Cucumber.api, с которым связана среда

ru.alfabank.alfatest.cucumber.api.AlfaPage
 Класс-аннотация для реализации паттерна PageObject

ru.alfabank.alfatest.cucumber.api.AlfaScenario
Позволяет заполнить хранилище переменных, существующее в рамках одного сценария, значениями и читать эти значения при необходимости.
Для сохранения/изъятия переменных используются методы setVar/getVar.
Сохранение переменной в хранилище: alfaScenario.setVar(<имя переменной>, <значение переменной>);
Получение значения переменной из хранилища: alfaScenario.getVar(<имя переменной>)

ru.alfabank.alfatest.cucumber.api.Spectators

ru.alfabank.steps.DefaultApiSteps
Шаги для тестирования API, доступные по умолчанию в каждом новом проекте

ru.alfabank.steps.DefaultSteps
В alfaScenario используется хранилище переменных. Для сохранения/изъятия переменных используются методы setVar/getVar
Каждая страница, с которой предполагается взаимодействие, должна быть описана в соответствующем классе,
наследующем AlfaPage. Для каждого элемента следует задать имя на русском, через аннотацию @Name, чтобы искать
можно было именно по русскому описанию, а не по селектору. Селекторы следует хранить только в классе страницы,
не в степах, в степах - взаимодействие по русскому названию элемента.

ru.alfabank.steps.InitialSetupSteps

ru.alfabank.tests.core.drivers.MobileChrome
Эмуляция мобильной версии браузера Google Chrome

ru.alfabank.tests.core.helpers.PropertyLoader
Класс для получения свойств




Переменные: запись и чтение
Фреймворк позволяет заполнить хранилище переменных, существующее в рамках одного сценария, значениями и читать эти значения при необходимости.
Само хранилище представялет из себя экземляр HashMap<String, Object>.
Инициализация пустой карты переменных происходит в момент установки тестового окружения:
 @Before(order = 2)
    public void setScenario(Scenario scenario) throws Exception {
        alfaScenario.setEnvironment(new AlfaEnvironment(scenario));
    }


Отображение в отчете справочной информации

Для того, чтобы в отчете появился блок Output с информацией, полезной для анализа отчета, можно воспользоваться следующим методом
alfaScenario.write("Текущий URL = " + currentUrl + " \nОжидаемый URL = " + expectedUrl);
Когда полезно?
В данном блоке можно вывести значение, сохраненное в конкретной переменной, взятое из поля на странице.
Когда сохранено значение поля "Сумма для полного погашения" с типом сумма в переменную "fullAmount"

Работа с REST запросами

В тестовом фреймворке реализована возможность отправки REST запросов и сохранения ответа в переменную.
Поддерживаются следующие типы запросов: GET, POST, PUT, DELETE.
 И вызван "POST" c URL "{creditsApi}credits/{docNumber}/repay", headers и parameters из таблицы. Полученный ответ сохранен в переменную "repayInfo"
       | type   | name          | value           |
       | header | applicationId | test            |
       | header | customerId    | <userCus>       |
       | body   | repayment     | <fileForCreate> |
В таблице переменных поддерживаются типы: header, parameter, body
Для body-параметра сейчас поддерживается как работа с телом запроса, хранящимся в папке restBodies, так и с указанием текста body в самом шаге в соответвующей ячейке

URL содержит переменные части

public String getURLwithPathParamsCalculated(String urlName)
Данный метод позволяет заменять имена переменных в URL на их значения.


Проверка логического выражения
У нас есть шаг, который например может выглядеть так:
Тогда верно выражение "amountToPay == amountMonthly + penalty + 100"
Реализация на groovy. Важно, отметить, что равенство проверяется использованием операнда "==", неравенство, как "!="